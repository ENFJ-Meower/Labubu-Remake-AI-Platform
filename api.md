# APIé…ç½®ä¸ä½¿ç”¨è¯´æ˜

## ğŸ“– æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†Labubu AIå¹³å°çš„åç«¯APIæ¥å…¥é…ç½®å’Œå·¥ä½œæµç³»ç»Ÿçš„ä½¿ç”¨æ–¹æ³•ã€‚

## ğŸ”§ APIé…ç½®

### åŸºç¡€é…ç½®

APIé…ç½®æ–‡ä»¶ä½äº `src/config/api.js`ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒé…ç½®ï¼š

```javascript
// APIåŸºç¡€é…ç½®
const API_CONFIG = {
  baseURL: 'http://localhost:8080/api/v1',  // åç«¯APIåœ°å€
  timeout: 30000,                          // è¯·æ±‚è¶…æ—¶æ—¶é—´
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json'
  }
}
```

### ç¯å¢ƒé…ç½®

æ ¹æ®éƒ¨ç½²ç¯å¢ƒä¿®æ”¹APIåŸºç¡€åœ°å€ï¼š

- **å¼€å‘ç¯å¢ƒ**: `http://localhost:8080/api/v1`
- **æµ‹è¯•ç¯å¢ƒ**: `https://test-api.labubu.com/api/v1`
- **ç”Ÿäº§ç¯å¢ƒ**: `https://api.labubu.com/api/v1`

### è®¤è¯é…ç½®

ç³»ç»Ÿæ”¯æŒä»¥ä¸‹è®¤è¯æ–¹å¼ï¼š

1. **Bearer Tokenè®¤è¯**ï¼ˆæ¨èï¼‰
2. **API Keyè®¤è¯**
3. **Basicè®¤è¯**

```javascript
// åœ¨localStorageä¸­è®¾ç½®è®¤è¯token
localStorage.setItem('authToken', 'your-jwt-token');

// æˆ–è®¾ç½®API Key
localStorage.setItem('apiKey', 'your-api-key');
```

### ç§Ÿæˆ·é…ç½®

ç³»ç»Ÿéœ€è¦é…ç½®ç§Ÿæˆ·IDï¼Œç”¨äºå¤šç§Ÿæˆ·æ•°æ®éš”ç¦»ï¼š

```javascript
// è®¾ç½®ç”¨æˆ·ä¿¡æ¯ï¼ˆåŒ…å«tenant_idï¼‰
const userInfo = {
  user_id: 'user123',
  tenant_id: 'tenant_abc',
  username: 'demo_user'
};
localStorage.setItem('userInfo', JSON.stringify(userInfo));
```

## ğŸš€ APIç«¯ç‚¹è¯´æ˜

### 1. æäº¤DAGå·¥ä½œæµ

**æ¥å£**: `POST /submit`

**åŠŸèƒ½**: æäº¤å®Œæ•´çš„DAGå·¥ä½œæµé…ç½®

**è¯·æ±‚æ ¼å¼**:
```json
{
  "dag_id": "string",
  "tenant_id": "string", 
  "nodes": {
    "node_id1": {
      "prompt": "å¤„ç†æç¤ºè¯",
      "service": "LLM"
    },
    "node_id2": {
      "prompt": "è½¬æ¢æç¤ºè¯", 
      "service": "STT"
    }
  },
  "edges": [
    {
      "from": "node_id1",
      "to": "node_id2", 
      "prompt": "è¿æ¥æç¤ºè¯"
    }
  ]
}
```

**å“åº”**:
```json
{
  "success": true,
  "dag_id": "generated_dag_id",
  "message": "DAG submitted successfully"
}
```

### 2. é€šçŸ¥å°±ç»ª

**æ¥å£**: `POST /ready`

**åŠŸèƒ½**: é€šçŸ¥åç«¯å·¥ä½œæµå·²å‡†å¤‡å¥½æ‰§è¡Œ

**è¯·æ±‚æ ¼å¼**:
```json
{
  "dag_id": "string",
  "tenant_id": "string"
}
```

### 3. è·å–DAGçŠ¶æ€

**æ¥å£**: `GET /status/{dag_id}`

**åŠŸèƒ½**: è·å–æŒ‡å®šDAGçš„æ‰§è¡ŒçŠ¶æ€

**å“åº”**:
```json
{
  "dag_id": "string",
  "status": "running|completed|failed|pending",
  "progress": 75,
  "current_node": "node_id2",
  "start_time": "2024-12-19T10:00:00Z",
  "end_time": null
}
```

### 4. è·å–å¤„ç†ç»“æœ

**æ¥å£**: `GET /message`

**åŠŸèƒ½**: è·å–å·¥ä½œæµæ‰§è¡Œç»“æœ

**å“åº”**:
```json
{
  "dag_id": "string",
  "results": {
    "node_id1": {
      "status": "completed",
      "output": "å¤„ç†ç»“æœæ•°æ®",
      "execution_time": 1.5
    }
  },
  "final_output": "æœ€ç»ˆç»“æœ"
}
```

### 5. è·å–æ‰€æœ‰DAG

**æ¥å£**: `GET /AllDag/{tenantID}`

**åŠŸèƒ½**: è·å–ç§Ÿæˆ·ä¸‹æ‰€æœ‰DAGåˆ—è¡¨

**å“åº”**:
```json
{
  "dags": [
    {
      "dag_id": "dag_001",
      "name": "æ–‡æœ¬å¤„ç†å·¥ä½œæµ",
      "status": "completed",
      "created_at": "2024-12-19T10:00:00Z",
      "node_count": 5
    }
  ],
  "total": 1
}
```

### 6. SSEçŠ¶æ€æµ

**æ¥å£**: `GET /status/stream/{dag_id}`

**åŠŸèƒ½**: å»ºç«‹SSEè¿æ¥ï¼Œå®æ—¶æ¥æ”¶çŠ¶æ€æ›´æ–°

**äº‹ä»¶æ ¼å¼**:
```json
{
  "event": "status_update",
  "data": {
    "dag_id": "string",
    "status": "running",
    "node_id": "current_node",
    "node_status": "processing",
    "progress": 60,
    "timestamp": "2024-12-19T10:05:00Z"
  }
}
```

## ğŸ¯ æ”¯æŒçš„æœåŠ¡ç±»å‹

### 1. LLM (Large Language Model)

**ç”¨é€”**: å¤§è¯­è¨€æ¨¡å‹æ–‡æœ¬å¤„ç†

**é…ç½®å‚æ•°**:
- `model`: æ¨¡å‹ç±»å‹ (gpt-4, gpt-3.5-turbo, claude-3)
- `temperature`: æ¸©åº¦å€¼ (0-2)
- `max_tokens`: æœ€å¤§tokenæ•°
- `prompt`: å¤„ç†æç¤ºè¯

**ç¤ºä¾‹æç¤ºè¯**:
```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡æœ¬åˆ†æå¸ˆã€‚è¯·åˆ†æä»¥ä¸‹æ–‡æœ¬çš„æƒ…æ„Ÿå€¾å‘ï¼Œå¹¶ç»™å‡ºè¯¦ç»†çš„ç†ç”±ã€‚

è¾“å…¥æ–‡æœ¬ï¼š{input_text}

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼å›å¤ï¼š
æƒ…æ„Ÿï¼š[æ­£é¢/è´Ÿé¢/ä¸­æ€§]
ç½®ä¿¡åº¦ï¼š[0-100]
ç†ç”±ï¼š[è¯¦ç»†åˆ†æ]
```

### 2. STT (Speech to Text)

**ç”¨é€”**: è¯­éŸ³è½¬æ–‡å­—

**é…ç½®å‚æ•°**:
- `language`: è¯­è¨€ä»£ç  (zh, en, ja, ko)
- `model`: è¯†åˆ«æ¨¡å‹ (whisper-1)
- `prompt`: è¯†åˆ«æŒ‡å¯¼æç¤º

**ç¤ºä¾‹æç¤ºè¯**:
```
è¯·å°†éŸ³é¢‘è½¬æ¢ä¸ºæ–‡å­—ï¼Œæ³¨æ„ä»¥ä¸‹è¦æ±‚ï¼š
1. ä¿æŒåŸå§‹è¯­è¨€çš„è¡¨è¾¾ä¹ æƒ¯
2. æ­£ç¡®è¯†åˆ«ä¸“ä¸šæœ¯è¯­
3. æ ‡æ³¨ä¸ç¡®å®šçš„è¯æ±‡ä¸º [?]
```

### 3. TTS (Text to Speech)

**ç”¨é€”**: æ–‡å­—è½¬è¯­éŸ³

**é…ç½®å‚æ•°**:
- `voice`: è¯­éŸ³ç±»å‹ (alloy, echo, fable, onyx, nova, shimmer)
- `speed`: è¯­é€Ÿ (0.25-4.0)
- `prompt`: è¯­éŸ³é£æ ¼æŒ‡å¯¼

**ç¤ºä¾‹æç¤ºè¯**:
```
è¯·ä»¥è‡ªç„¶ã€å‹å¥½çš„è¯­è°ƒæœ—è¯»ä»¥ä¸‹æ–‡å­—ï¼š
- è¯­é€Ÿé€‚ä¸­ï¼Œåå­—æ¸…æ™°
- åœ¨æ ‡ç‚¹ç¬¦å¤„é€‚å½“åœé¡¿
- æƒ…æ„Ÿè¡¨è¾¾è‡ªç„¶
```

### 4. pic2text (Image to Text)

**ç”¨é€”**: å›¾ç‰‡æ–‡å­—è¯†åˆ«

**é…ç½®å‚æ•°**:
- `language`: è¯†åˆ«è¯­è¨€
- `format`: è¾“å‡ºæ ¼å¼ (plain, markdown, json)
- `prompt`: è¯†åˆ«æŒ‡å¯¼

**ç¤ºä¾‹æç¤ºè¯**:
```
è¯·æå–å›¾ç‰‡ä¸­çš„æ‰€æœ‰æ–‡å­—ä¿¡æ¯ï¼Œè¦æ±‚ï¼š
1. ä¿æŒåŸå§‹æ’ç‰ˆç»“æ„
2. è¯†åˆ«è¡¨æ ¼å’Œåˆ—è¡¨æ ¼å¼
3. æ ‡æ³¨å›¾ç‰‡ä¸­çš„éæ–‡å­—å…ƒç´ 
4. è¾“å‡ºä¸ºMarkdownæ ¼å¼
```

### 5. text2pic (Text to Image)

**ç”¨é€”**: æ–‡å­—ç”Ÿæˆå›¾ç‰‡

**é…ç½®å‚æ•°**:
- `size`: å›¾ç‰‡å°ºå¯¸ (256x256, 512x512, 1024x1024, 1792x1024, 1024x1792)
- `style`: å›¾ç‰‡é£æ ¼ (natural, vivid, artistic)
- `quality`: è´¨é‡ (standard, hd)
- `prompt`: ç”ŸæˆæŒ‡å¯¼

**ç¤ºä¾‹æç¤ºè¯**:
```
æ ¹æ®ç”¨æˆ·æè¿°ç”Ÿæˆé«˜è´¨é‡å›¾ç‰‡ï¼Œè¦æ±‚ï¼š
1. ç”»é¢æ„å›¾åˆç†ï¼Œä¸»ä½“çªå‡º
2. è‰²å½©æ­é…å’Œè°ï¼Œå…‰å½±è‡ªç„¶
3. é£æ ¼ä¸æè¿°ç›¸ç¬¦
4. ç»†èŠ‚ä¸°å¯Œï¼Œè´¨æ„Ÿé€¼çœŸ

ç”¨æˆ·æè¿°ï¼š{user_input}
```

## ğŸ› ï¸ å·¥ä½œæµç¼–è¾‘å™¨ä½¿ç”¨æŒ‡å—

### 1. èŠ‚ç‚¹åˆ›å»º

1. ä»å·¦ä¾§èŠ‚ç‚¹è°ƒè‰²æ¿æ‹–æ‹½èŠ‚ç‚¹åˆ°ç”»å¸ƒ
2. èŠ‚ç‚¹ç±»å‹åŒ…æ‹¬ï¼š
   - **æ§åˆ¶èŠ‚ç‚¹**: Start, End, Condition
   - **AIæœåŠ¡**: LLM, STT, TTS, pic2text, text2pic
   - **å·¥å…·èŠ‚ç‚¹**: Process, Transform

### 2. èŠ‚ç‚¹é…ç½®

1. ç‚¹å‡»èŠ‚ç‚¹é€‰ä¸­
2. åœ¨å³ä¾§é…ç½®é¢æ¿è®¾ç½®ï¼š
   - èŠ‚ç‚¹åç§°å’Œæè¿°
   - æœåŠ¡ç±»å‹ï¼ˆAIæœåŠ¡èŠ‚ç‚¹å¿…éœ€ï¼‰
   - æç¤ºè¯é…ç½®ï¼ˆAIæœåŠ¡èŠ‚ç‚¹å¿…éœ€ï¼‰
   - ç‰¹å®šæœåŠ¡å‚æ•°
   - è¾“å…¥è¾“å‡ºç«¯å£

### 3. è¿æ¥åˆ›å»º

1. ç‚¹å‡»æºèŠ‚ç‚¹çš„è¾“å‡ºç«¯å£
2. æ‹–æ‹½åˆ°ç›®æ ‡èŠ‚ç‚¹çš„è¾“å…¥ç«¯å£
3. å¯åœ¨è¿æ¥ä¸Šè®¾ç½®ä¼ é€’æç¤ºè¯

### 4. å·¥ä½œæµéªŒè¯

ç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯ï¼š
- å¿…é¡»åŒ…å«å¼€å§‹å’Œç»“æŸèŠ‚ç‚¹
- AIæœåŠ¡èŠ‚ç‚¹å¿…é¡»é…ç½®æœåŠ¡ç±»å‹å’Œæç¤ºè¯
- èŠ‚ç‚¹è¿æ¥çš„æœ‰æ•ˆæ€§

### 5. æµ‹è¯•ä¸éƒ¨ç½²

1. **ä¿å­˜å·¥ä½œæµ**: æäº¤åˆ°åç«¯ä¿å­˜
2. **æµ‹è¯•è¿è¡Œ**: å¯åŠ¨æµ‹è¯•æ‰§è¡Œå¹¶ç›‘æ§çŠ¶æ€
3. **éƒ¨ç½²**: å‘å¸ƒä¸ºå¯ç”¨çš„å·¥ä½œæµæœåŠ¡

## ğŸ” é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------|
| 401 | è®¤è¯å¤±è´¥ | æ£€æŸ¥tokenæ˜¯å¦æœ‰æ•ˆ |
| 403 | æƒé™ä¸è¶³ | ç¡®è®¤ç§Ÿæˆ·æƒé™é…ç½® |
| 404 | DAGä¸å­˜åœ¨ | æ£€æŸ¥dag_idæ˜¯å¦æ­£ç¡® |
| 422 | æ•°æ®æ ¼å¼é”™è¯¯ | éªŒè¯è¯·æ±‚æ•°æ®æ ¼å¼ |
| 500 | æœåŠ¡å™¨é”™è¯¯ | è”ç³»æŠ€æœ¯æ”¯æŒ |

### è°ƒè¯•æŠ€å·§

1. **å¼€å¯æµè§ˆå™¨å¼€å‘è€…å·¥å…·**æŸ¥çœ‹ç½‘ç»œè¯·æ±‚
2. **æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—**äº†è§£è¯¦ç»†é”™è¯¯ä¿¡æ¯
3. **éªŒè¯APIé…ç½®**ç¡®è®¤baseURLå’Œè®¤è¯ä¿¡æ¯
4. **æµ‹è¯•ç½‘ç»œè¿æ¥**ç¡®ä¿èƒ½è®¿é—®åç«¯æœåŠ¡

## ğŸ“‹ æœ€ä½³å®è·µ

### 1. æç¤ºè¯è®¾è®¡

- **æ˜ç¡®è§’è‰²å®šä¹‰**: ä¸ºAIæŒ‡å®šæ¸…æ™°çš„è§’è‰²å’ŒèŒè´£
- **è¯¦ç»†ä»»åŠ¡æè¿°**: è¯´æ˜å…·ä½“è¦å®Œæˆçš„ä»»åŠ¡
- **è¾“å‡ºæ ¼å¼è§„èŒƒ**: æŒ‡å®šæœŸæœ›çš„è¾“å‡ºæ ¼å¼
- **ç¤ºä¾‹æ¼”ç¤º**: æä¾›Few-shotç¤ºä¾‹
- **é”™è¯¯å¤„ç†**: è¯´æ˜å¼‚å¸¸æƒ…å†µçš„å¤„ç†æ–¹å¼

### 2. å·¥ä½œæµè®¾è®¡

- **æ¨¡å—åŒ–è®¾è®¡**: å°†å¤æ‚ä»»åŠ¡æ‹†åˆ†ä¸ºç®€å•èŠ‚ç‚¹
- **é”™è¯¯å¤„ç†**: æ·»åŠ æ¡ä»¶èŠ‚ç‚¹å¤„ç†å¼‚å¸¸æƒ…å†µ
- **æ•°æ®æµæ¸…æ™°**: ç¡®ä¿æ•°æ®åœ¨èŠ‚ç‚¹é—´æ­£ç¡®ä¼ é€’
- **æ€§èƒ½ä¼˜åŒ–**: é¿å…ä¸å¿…è¦çš„ä¸²è¡Œå¤„ç†

### 3. å®‰å…¨è€ƒè™‘

- **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**: ä¸åœ¨æç¤ºè¯ä¸­åŒ…å«æ•æ„Ÿæ•°æ®
- **è¾“å…¥éªŒè¯**: å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡ŒéªŒè¯å’Œè¿‡æ»¤
- **æƒé™æ§åˆ¶**: ç¡®ä¿ç§Ÿæˆ·æ•°æ®éš”ç¦»
- **æ—¥å¿—è®°å½•**: è®°å½•å…³é”®æ“ä½œç”¨äºå®¡è®¡

## ğŸš€ éƒ¨ç½²æŒ‡å—

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…ä¾èµ–
npm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# é¢„è§ˆæ„å»ºç»“æœ
npm run preview
```

### 2. ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env.production` æ–‡ä»¶ï¼š

```bash
# APIé…ç½®
VITE_API_BASE_URL=https://api.labubu.com/api/v1
VITE_API_TIMEOUT=30000

# è®¤è¯é…ç½®
VITE_AUTH_TYPE=bearer
VITE_DEFAULT_TENANT=production_tenant

# åŠŸèƒ½å¼€å…³
VITE_ENABLE_SSE=true
VITE_ENABLE_FILE_UPLOAD=true
```

### 3. æœåŠ¡å™¨é…ç½®

#### Nginxé…ç½®ç¤ºä¾‹

```nginx
server {
    listen 80;
    server_name labubu.com;
    
    location / {
        root /var/www/labubu-ai-platform/dist;
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://backend-server:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜è¯·è”ç³»ï¼š

- **æŠ€æœ¯æ–‡æ¡£**: [GitHub Wiki](https://github.com/ENFJ-Meower/Labubu-Remake-AI-Platform/wiki)
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/ENFJ-Meower/Labubu-Remake-AI-Platform/issues)
- **é‚®ä»¶æ”¯æŒ**: support@labubu.com

---

**æœ€åæ›´æ–°**: 2024-12-19
**ç‰ˆæœ¬**: v4.0